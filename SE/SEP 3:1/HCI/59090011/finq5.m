clcclear;close all;load ecgdata.matfs = 100; % HzR_threshold = 200; %define a threshold based on observing raw ECGt1 = 500; %select the start time of a segment (sec)t2 = 800; %select the end time of a segment (sec)t1_samp = t1*fs+1; % convert the start time to sample numbert2_samp = t2*fs; % convert the end time to sample numberecg = val(1,t1_samp:t2_samp);min_ecg = min(ecg);ecg_offset = ecg-min_ecg; % make offset to positive sidet_ecg = (t1_samp:t2_samp)*(1/fs);[pks locs] = findpeaks(ecg_offset,"MinPeakHeight",R_threshold);hrv = 1000*(locs(2:end)-locs(1:end-1)); %make a milisec unit by x1000meanval = mean(hrv)stdval = std(hrv)figure;a1 = subplot(3,1,1); plot(ecg); hold on; plot(locs,pks+min_ecg,'*');xlabel('Time(s)'); ylabel('Amplitude'); title(['Raw ECG: ' num2str(t1) ' to ' num2str(t2) 'sec']);a2 = subplot(3,1,2); plot(ecg_offset); hold on; plot(locs,pks,'*');xlabel('Time(s)'); ylabel('Amplitude'); title(['Offset raw ECG: ' num2str(t1) ' to ' num2str(t2) 'sec']);a3 = subplot(3,1,3); plot(locs(2:end),hrv);xlabel('Time(s)'); ylabel('HRV(ms)'); title('Heart Rate Variability');linkaxes([a1 a2 a3],'x');